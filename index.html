<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Expense Tracker</title>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body {
        margin: 0;
        font-family: system-ui, -apple-system, sans-serif;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      /* ================= FIREBASE ================= */
      const firebaseConfig = {
        apiKey: "AIzaSyAoofQz9iOxLDl9Xa_f_UbzZCkshNCjUW4",
        authDomain: "expense-report-826a7.firebaseapp.com",
        projectId: "expense-report-826a7",
        storageBucket: "expense-report-826a7.firebasestorage.app",
        messagingSenderId: "238599367354",
        appId: "1:238599367354:web:dd12a7dc2c6e70aea0f083",
      };

      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }

      const db = firebase.firestore();
      const { useState, useEffect, useMemo } = React;

      /* ================= ICONS ================= */
      const Plus = () => (
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
      );

      const Trash2 = () => (
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <polyline points="3 6 5 6 21 6" />
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
        </svg>
      );

      const TrendingUp = () => (
        <svg
          width="40"
          height="40"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
          <polyline points="17 6 23 6 23 12" />
        </svg>
      );

      const TrendingDown = () => (
        <svg
          width="40"
          height="40"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <polyline points="23 18 13.5 8.5 8.5 13.5 1 6" />
          <polyline points="17 18 23 18 23 12" />
        </svg>
      );

      const Calendar = () => (
        <svg
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <rect x="3" y="4" width="18" height="18" rx="2" />
          <line x1="16" y1="2" x2="16" y2="6" />
          <line x1="8" y1="2" x2="8" y2="6" />
          <line x1="3" y1="10" x2="21" y2="10" />
        </svg>
      );

      /* ================= MAIN COMPONENT ================= */
      function MonthlyExpenseSheet() {
        const FIXED_USER_ID = "rakesh-expense-tracker";
        const [userId] = useState(FIXED_USER_ID);
        const [month, setMonth] = useState("January");
        const [year, setYear] = useState("2025");
        const [syncStatus, setSyncStatus] = useState("synced");

        const expenseOptions = [
          "Ravi Fast Food",
          "E Trade",
          "Fuel",
          "Udayavani Canteen",
          "Hotel Manohar Bhavan",
          "Manipal Lunch Home",
          "Vinayak Store",
          "Darsh Fast Food",
          "Anand Bhavan",
          "Medical Store",
          "Other (Custom)",
        ];

        const mealOptions = ["", "Lunch", "Tea"];

        const [expenses, setExpenses] = useState([
          {
            id: 1,
            date: "2025-01-01",
            description: "Opening Balance (Salary)",
            credit: "50000",
            debit: "",
            meal: "",
            isCustom: true,
          },
        ]);

        /* ================= CALCULATIONS ================= */
        const calculations = useMemo(() => {
          const openingBalance = expenses
            .filter((e) => e.description === "Opening Balance (Salary)")
            .reduce((s, e) => s + (+e.credit || 0), 0);

          const totalDebit = expenses
            .filter((e) => e.description !== "Opening Balance (Salary)")
            .reduce((s, e) => s + (+e.debit || 0), 0);

          const totalCredit = expenses
            .filter((e) => e.description !== "Opening Balance (Salary)")
            .reduce((s, e) => s + (+e.credit || 0), 0);

          const currentBalance = openingBalance + totalCredit - totalDebit;

          return { openingBalance, totalDebit, totalCredit, currentBalance };
        }, [expenses]);

        /* ================= FIREBASE SYNC ================= */
        useEffect(() => {
          db.collection("expenseTracker")
            .doc(userId)
            .set({ month, year, expenses }, { merge: true })
            .then(() => setSyncStatus("synced"))
            .catch(() => setSyncStatus("error"));
        }, [month, year, expenses]);

        /* ================= UI ================= */
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
            <div className="max-w-7xl mx-auto bg-white rounded-lg shadow-lg p-6">
              <div className="flex items-center gap-3 mb-4">
                <Calendar />
                <h1 className="text-3xl font-bold">Monthly Expense Sheet</h1>
              </div>

              <p className="mb-4 text-sm text-gray-600">
                Sync Status: <strong>{syncStatus}</strong>
              </p>

              <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div>
                  <p className="text-sm">Opening Balance</p>
                  <p className="text-xl font-bold text-blue-600">
                    ₹{calculations.openingBalance}
                  </p>
                </div>
                <div>
                  <p className="text-sm">Other Credits</p>
                  <p className="text-xl font-bold text-green-600">
                    ₹{calculations.totalCredit}
                  </p>
                </div>
                <div>
                  <p className="text-sm">Total Debit</p>
                  <p className="text-xl font-bold text-red-600">
                    ₹{calculations.totalDebit}
                  </p>
                </div>
                <div>
                  <p className="text-sm">Current Balance</p>
                  <p className="text-xl font-bold text-indigo-600">
                    ₹{calculations.currentBalance}
                  </p>
                </div>
              </div>

              <p className="text-center text-sm text-gray-500">
                ✅ Code cleaned & errors fixed
              </p>
            </div>
          </div>
        );
      }

      ReactDOM.render(<MonthlyExpenseSheet />, document.getElementById("root"));
    </script>
  </body>
</html>
