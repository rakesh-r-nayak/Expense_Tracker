<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Finance Tracker</title>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- React -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        background: linear-gradient(to bottom right, #f0f9ff, #e0e7ff, #ede9fe);
        min-height: 100vh;
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }

      .table-container::after {
        content: "‚Üê Scroll horizontally ‚Üí";
        display: block;
        text-align: center;
        padding: 12px;
        background: #eef2ff;
        color: #6366f1;
        font-size: 0.875rem;
        font-weight: 500;
        border-bottom-left-radius: 0.75rem;
        border-bottom-right-radius: 0.75rem;
      }
      @media (min-width: 768px) {
        .table-container::after {
          display: none;
        }
      }

      .card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
      }
      .card:hover {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        transform: translateY(-4px);
      }

      tbody tr:hover {
        background-color: #f8fafc !important;
        transition: background-color 0.2s;
      }

      input:focus,
      select:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
        border-color: #6366f1;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      const { useState, useEffect, useMemo, useCallback, useRef } = React;

      const firebaseConfig = {
        apiKey: "AIzaSyAoofQz9iOxLDl9Xa_f_UbzZCkshNCjUW4",
        authDomain: "expense-report-826a7.firebaseapp.com",
        projectId: "expense-report-826a7",
        storageBucket: "expense-report-826a7.firebasestorage.app",
        messagingSenderId: "238599367354",
        appId: "1:238599367354:web:dd12a7dc2c6e70aea0f083",
        measurementId: "G-QW3LYEC24T",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const FIXED_USER_ID = "rakesh-expense-tracker";

      const Plus = () => (
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
      );

      const Trash2 = () => (
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <polyline points="3 6 5 6 21 6" />
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <line x1="10" y1="11" x2="10" y2="17" />
          <line x1="14" y1="11" x2="14" y2="17" />
        </svg>
      );

      const Calendar = () => (
        <svg
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
          <line x1="16" y1="2" x2="16" y2="6" />
          <line x1="8" y1="2" x2="8" y2="6" />
          <line x1="3" y1="10" x2="21" y2="10" />
        </svg>
      );

      const CreditCard = () => (
        <svg
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
          <line x1="1" y1="10" x2="23" y2="10" />
        </svg>
      );

      const Cloud = () => (
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
        >
          <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" />
        </svg>
      );

      const App = () => {
        const [activeTab, setActiveTab] = useState("monthly");

        return (
          <div className="min-h-screen">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <header className="text-center mb-12">
                <h1 className="text-4xl sm:text-5xl font-extrabold text-indigo-800 mb-3">
                  Personal Finance Tracker
                </h1>
                <p className="text-lg text-gray-600">
                  Track your monthly cash & credit card expenses with ease
                </p>
              </header>

              <div className="flex flex-wrap justify-center gap-6 mb-12 bg-white rounded-2xl shadow-lg p-4 max-w-3xl mx-auto">
                <button
                  onClick={() => setActiveTab("monthly")}
                  className={`flex items-center gap-4 px-10 py-5 rounded-xl font-bold text-lg transition-all transform ${
                    activeTab === "monthly"
                      ? "bg-indigo-600 text-white shadow-xl scale-105"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200 hover:scale-102"
                  }`}
                >
                  <Calendar /> Monthly Cash
                </button>
                <button
                  onClick={() => setActiveTab("credit")}
                  className={`flex items-center gap-4 px-10 py-5 rounded-xl font-bold text-lg transition-all transform ${
                    activeTab === "credit"
                      ? "bg-red-600 text-white shadow-xl scale-105"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200 hover:scale-102"
                  }`}
                >
                  <CreditCard /> Credit Card
                </button>
              </div>

              <div className="card p-6 sm:p-10">
                {activeTab === "monthly" ? (
                  <MonthlyExpenseSheet />
                ) : (
                  <CreditCardExpenseSheet />
                )}
              </div>
            </div>
          </div>
        );
      };

      const MonthlyExpenseSheet = () => {
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        const now = new Date();
        const [month, setMonth] = useState(months[now.getMonth()]);
        const [year, setYear] = useState(now.getFullYear().toString());
        const [startingBalance, setStartingBalance] = useState(50000);
        const [syncStatus, setSyncStatus] = useState("synced");
        const [expenses, setExpenses] = useState([]);
        const isInitialLoad = useRef(true);

        const monthIndex = months.indexOf(month);
        const monthKey = `${year}-${String(monthIndex + 1).padStart(2, "0")}`;

        const expenseOptions = [
          "Ravi Fast Food",
          "E Trade",
          "Fuel",
          "Udayavani Canteen",
          "Hotel Manohar Bhavan",
          "Manipal Lunch Home",
          "Vinayak Store",
          "Darsh Fast Food",
          "Anand Bhavan",
          "Medical Store",
          "Other (Custom)",
        ];

        const mealOptions = ["", "Lunch", "Tea"];

        const syncToCloud = useCallback(
          async (data) => {
            if (isInitialLoad.current) return;
            try {
              setSyncStatus("syncing");
              await db
                .collection("expenseTracker")
                .doc(FIXED_USER_ID)
                .collection("months")
                .doc(monthKey)
                .set(data);
              setSyncStatus("synced");
            } catch (error) {
              console.error("Firebase sync error:", error);
              setSyncStatus("error");
            }
          },
          [monthKey]
        );

        const loadFromCloud = useCallback(async () => {
          try {
            const doc = await db
              .collection("expenseTracker")
              .doc(FIXED_USER_ID)
              .collection("months")
              .doc(monthKey)
              .get();
            if (doc.exists) {
              const data = doc.data();
              setStartingBalance(data.startingBalance ?? 50000);
              setExpenses(data.expenses ?? []);
              if (data.month && data.year) {
                setMonth(data.month);
                setYear(data.year);
              }
            } else {
              setExpenses([]);
            }
          } catch (error) {
            console.error("Firebase load error:", error);
          }
        }, [monthKey]);

        useEffect(() => {
          loadFromCloud();
        }, [loadFromCloud]);

        useEffect(() => {
          if (isInitialLoad.current) {
            isInitialLoad.current = false;
            return;
          }
          const dataToSync = {
            month,
            year,
            startingBalance,
            expenses,
            lastUpdated: new Date().toISOString(),
          };
          const timer = setTimeout(() => syncToCloud(dataToSync), 800);
          return () => clearTimeout(timer);
        }, [month, year, startingBalance, expenses, syncToCloud]);

        const exportToExcel = () => {
          const wsData = [
            ["Date", "Description", "Meal", "Debit", "Credit"],
            ...expenses.map((e) => [
              e.date,
              e.description,
              e.meal,
              e.debit,
              e.credit,
            ]),
          ];
          const ws = XLSX.utils.aoa_to_sheet(wsData);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Expenses");
          XLSX.writeFile(wb, `Expense_${month}_${year}.xlsx`);
        };

        const importFromExcel = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (ev) => {
            const data = new Uint8Array(ev.target.result);
            const wb = XLSX.read(data, { type: "array" });
            const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {
              header: 1,
            });
            const maxId = expenses.length
              ? Math.max(...expenses.map((ex) => ex.id))
              : 0;
            const newExpenses = rows.slice(1).map((row, i) => ({
              id: maxId + i + 1,
              date: row[0] || "",
              description: row[1] || "",
              meal: row[2] || "",
              debit: row[3] || "",
              credit: row[4] || "",
              isCustom: true,
            }));
            setExpenses(newExpenses);
          };
          reader.readAsArrayBuffer(file);
        };

        const addExpense = () => {
          const insertExpenseAt = (index, position = "below") => {
            setExpenses((prev) => {
              const newId = prev.length
                ? Math.max(...prev.map((e) => e.id)) + 1
                : 1;

              const newExpense = {
                id: newId,
                date:
                  prev[index]?.date || new Date().toISOString().split("T")[0],
                description: "",
                debit: "",
                credit: "",
                meal: "",
                isCustom: false,
              };

              const newList = [...prev];
              const insertIndex = position === "above" ? index : index + 1;
              newList.splice(insertIndex, 0, newExpense);

              return newList;
            });
          };

          const newId = expenses.length
            ? Math.max(...expenses.map((e) => e.id)) + 1
            : 1;
          setExpenses((prev) => [
            ...prev,
            {
              id: newId,
              date: new Date().toISOString().split("T")[0],
              description: "",
              debit: "",
              credit: "",
              meal: "",
              isCustom: false,
            },
          ]);
        };

        const deleteExpense = useCallback((id) => {
          setExpenses((prev) => prev.filter((e) => e.id !== id));
        }, []);

        const updateExpense = useCallback((id, field, value) => {
          setExpenses((prev) =>
            prev.map((e) => {
              if (e.id !== id) return e;
              if (field === "debit") return { ...e, debit: value, credit: "" };
              if (field === "credit") return { ...e, credit: value, debit: "" };
              return { ...e, [field]: value };
            })
          );
        }, []);

        const calculations = useMemo(() => {
          const openingBalance = Number(startingBalance) || 0;
          const totalDebit = expenses.reduce(
            (s, e) => s + (Number(e.debit) || 0),
            0
          );
          const totalCredit = expenses.reduce(
            (s, e) => s + (Number(e.credit) || 0),
            0
          );
          const netDebit = totalDebit - totalCredit;
          const currentBalance = openingBalance + totalCredit - totalDebit;

          const lunchTotal = expenses
            .filter((e) => e.meal === "Lunch")
            .reduce((s, e) => s + (Number(e.debit) || 0), 0);
          const teaTotal = expenses
            .filter((e) => e.meal === "Tea")
            .reduce((s, e) => s + (Number(e.debit) || 0), 0);

          const lunchCount = expenses.filter((e) => e.meal === "Lunch").length;
          const teaCount = expenses.filter((e) => e.meal === "Tea").length;

          const fuelTotal = expenses
            .filter((e) => e.description === "Fuel")
            .reduce((s, e) => s + (Number(e.debit) || 0), 0);

          return {
            openingBalance,
            totalDebit,
            totalCredit,
            netDebit,
            currentBalance,
            lunchTotal,
            teaTotal,
            lunchCount,
            teaCount,
            fuelTotal,
          };
        }, [expenses, startingBalance]);

        const getSyncStatusColor = () => {
          return syncStatus === "syncing"
            ? "text-yellow-600"
            : syncStatus === "synced"
            ? "text-green-600"
            : syncStatus === "error"
            ? "text-red-600"
            : "text-gray-600";
        };

        const getSyncStatusText = () => {
          return syncStatus === "syncing"
            ? "Syncing..."
            : syncStatus === "synced"
            ? "All changes saved"
            : syncStatus === "error"
            ? "Sync error"
            : "Ready";
        };

        return (
          <div>
            <div className="flex flex-col gap-6 mb-8">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <Calendar />
                  <h1 className="text-3xl font-bold text-gray-800">
                    Monthly Cash Expenses
                  </h1>
                </div>
                <div
                  className={`flex items-center gap-2 ${getSyncStatusColor()}`}
                >
                  <Cloud />
                  <span className="text-sm font-medium">
                    {getSyncStatusText()}
                  </span>
                </div>
              </div>

              <div className="flex flex-wrap gap-4">
                <button
                  onClick={addExpense}
                  className="flex items-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-xl hover:bg-indigo-700 font-medium shadow-md"
                >
                  <Plus /> Add Row
                </button>
                <button
                  onClick={exportToExcel}
                  className="bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 font-medium shadow-md"
                >
                  Export Excel
                </button>
                <label className="bg-blue-600 text-white px-6 py-3 rounded-xl cursor-pointer hover:bg-blue-700 font-medium shadow-md text-center">
                  Import Excel
                  <input
                    type="file"
                    accept=".xlsx,.xls"
                    onChange={importFromExcel}
                    className="hidden"
                  />
                </label>
              </div>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Month
                </label>
                <select
                  value={month}
                  onChange={(e) => setMonth(e.target.value)}
                  className="w-full px-5 py-4 border border-gray-300 rounded-xl text-base"
                >
                  {months.map((m) => (
                    <option key={m} value={m}>
                      {m}
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Year
                </label>
                <input
                  type="number"
                  value={year}
                  onChange={(e) => setYear(e.target.value)}
                  className="w-full px-5 py-4 border border-gray-300 rounded-xl text-base"
                />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Starting Balance (‚Çπ)
                </label>
                <input
                  type="number"
                  value={startingBalance}
                  onChange={(e) =>
                    setStartingBalance(Number(e.target.value) || 0)
                  }
                  className="w-full px-5 py-4 border border-gray-300 rounded-xl text-base"
                />
              </div>
            </div>

            <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg mb-6">
              <p className="text-sm text-blue-800">
                <strong>User ID:</strong> {FIXED_USER_ID}
              </p>
              <p className="text-xs text-blue-600 mt-1">
                Data is automatically synced to Firebase
              </p>
            </div>

            <div className="overflow-x-auto table-container -mx-4 sm:mx-0 mb-10">
              {calculations.currentBalance < 0 && (
                <div className="bg-red-100 text-red-800 px-6 py-4 mx-4 rounded-xl text-sm font-medium mb-4">
                  Warning: Your expenses exceed your available balance!
                </div>
              )}
              <table className="w-full min-w-[900px]">
                <thead className="bg-indigo-600 text-white">
                  <tr>
                    <th className="px-5 py-4 text-left font-semibold text-sm">
                      Date
                    </th>
                    <th className="px-5 py-4 text-left font-semibold text-sm">
                      Expense Description
                    </th>
                    <th className="px-5 py-4 text-left font-semibold text-sm">
                      Meal
                    </th>
                    <th className="px-5 py-4 text-left font-semibold text-sm">
                      Debit (‚Çπ)
                    </th>
                    <th className="px-5 py-4 text-left font-semibold text-sm">
                      Credit (‚Çπ)
                    </th>
                    <th className="px-5 py-4 text-center font-semibold text-sm">
                      Action
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {expenses.map((expense, i) => (
                    <tr
                      key={expense.id}
                      className={i % 2 === 0 ? "bg-gray-50" : "bg-white"}
                    >
                      <td className="px-5 py-3">
                        <input
                          type="date"
                          value={expense.date}
                          onChange={(e) =>
                            updateExpense(expense.id, "date", e.target.value)
                          }
                          className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 text-sm"
                        />
                      </td>
                      <td className="px-5 py-3">
                        {expense.isCustom ? (
                          <div className="flex flex-col sm:flex-row gap-2">
                            <input
                              type="text"
                              value={expense.description}
                              onChange={(e) =>
                                updateExpense(
                                  expense.id,
                                  "description",
                                  e.target.value
                                )
                              }
                              placeholder="Custom description"
                              className="flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 text-sm"
                            />
                            <button
                              onClick={() =>
                                setExpenses((prev) =>
                                  prev.map((ex) =>
                                    ex.id === expense.id
                                      ? {
                                          ...ex,
                                          isCustom: false,
                                          description: "",
                                        }
                                      : ex
                                  )
                                )
                              }
                              className="px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 rounded"
                            >
                              ‚Ü©
                            </button>
                          </div>
                        ) : (
                          <select
                            value={expense.description}
                            onChange={(e) => {
                              const val = e.target.value;
                              if (val === "Other (Custom)") {
                                setExpenses((prev) =>
                                  prev.map((ex) =>
                                    ex.id === expense.id
                                      ? {
                                          ...ex,
                                          isCustom: true,
                                          description: "",
                                        }
                                      : ex
                                  )
                                );
                              } else {
                                updateExpense(expense.id, "description", val);
                              }
                            }}
                            className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 text-sm"
                          >
                            <option value="">Select...</option>
                            {expenseOptions.map((opt) => (
                              <option key={opt} value={opt}>
                                {opt}
                              </option>
                            ))}
                          </select>
                        )}
                      </td>
                      <td className="px-5 py-3">
                        <select
                          value={expense.meal}
                          onChange={(e) =>
                            updateExpense(expense.id, "meal", e.target.value)
                          }
                          className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 text-sm"
                        >
                          {mealOptions.map((opt) => (
                            <option key={opt} value={opt}>
                              {opt}
                            </option>
                          ))}
                        </select>
                      </td>
                      <td className="px-5 py-3">
                        <input
                          type="number"
                          min="0"
                          value={expense.debit}
                          onChange={(e) =>
                            updateExpense(expense.id, "debit", e.target.value)
                          }
                          placeholder="0"
                          className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 text-sm"
                        />
                      </td>
                      <td className="px-5 py-3">
                        <input
                          type="number"
                          min="0"
                          value={expense.credit}
                          onChange={(e) =>
                            updateExpense(expense.id, "credit", e.target.value)
                          }
                          placeholder="0"
                          className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 text-sm"
                        />
                      </td>
                      <td className="px-5 py-3 text-center space-x-2">
                        <button
                          onClick={() => insertExpenseAt(i, "above")}
                          className="text-indigo-600 hover:text-indigo-800 text-sm font-semibold"
                          title="Insert Above"
                        >
                          +‚Üë
                        </button>

                        <button
                          onClick={() => insertExpenseAt(i, "below")}
                          className="text-indigo-600 hover:text-indigo-800 text-sm font-semibold"
                          title="Insert Below"
                        >
                          +‚Üì
                        </button>

                        <button
                          onClick={() => deleteExpense(expense.id)}
                          className="text-red-600 hover:text-red-800 p-2"
                          title="Delete"
                        >
                          <Trash2 />
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
              <div className="card p-6 text-center bg-gradient-to-br from-blue-50 to-blue-100">
                <div className="text-5xl mb-3">üí∞</div>
                <p className="text-sm font-medium text-blue-700">
                  Opening Balance
                </p>
                <p className="text-3xl font-bold text-blue-800 mt-2">
                  ‚Çπ{calculations.openingBalance.toLocaleString()}
                </p>
              </div>
              <div className="card p-6 text-center bg-gradient-to-br from-green-50 to-green-100">
                <div className="text-5xl mb-3">üìà</div>
                <p className="text-sm font-medium text-green-700">
                  Total Credits
                </p>
                <p className="text-3xl font-bold text-green-800 mt-2">
                  ‚Çπ{calculations.totalCredit.toLocaleString()}
                </p>
              </div>
              <div className="card p-6 text-center bg-gradient-to-br from-red-50 to-red-100">
                <div className="text-5xl mb-3">üìâ</div>
                <p className="text-sm font-medium text-red-700">Net Debit</p>
                <p className="text-3xl font-bold text-red-800 mt-2">
                  ‚Çπ{calculations.netDebit.toLocaleString()}
                </p>
              </div>
              <div className="card p-6 text-center bg-gradient-to-br from-purple-50 to-purple-100">
                <div className="text-5xl mb-3">üè¶</div>
                <p className="text-sm font-medium text-purple-700">
                  Current Balance
                </p>
                <p
                  className={`text-3xl font-bold mt-2 ${
                    calculations.currentBalance >= 0
                      ? "text-purple-800"
                      : "text-red-600"
                  }`}
                >
                  ‚Çπ{calculations.currentBalance.toLocaleString()}
                </p>
              </div>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-3 gap-6">
              <div className="card p-6 text-center bg-gradient-to-br from-orange-50 to-orange-100">
                <div className="text-5xl mb-3">üç±</div>
                <p className="text-lg font-bold text-orange-700">
                  {calculations.lunchCount} Lunches
                </p>
                <p className="text-2xl font-bold text-orange-800 mt-2">
                  ‚Çπ{calculations.lunchTotal.toLocaleString()}
                </p>
              </div>
              <div className="card p-6 text-center bg-gradient-to-br from-purple-50 to-purple-100">
                <div className="text-5xl mb-3">‚òï</div>
                <p className="text-lg font-bold text-purple-700">
                  {calculations.teaCount} Teas
                </p>
                <p className="text-2xl font-bold text-purple-800 mt-2">
                  ‚Çπ{calculations.teaTotal.toLocaleString()}
                </p>
              </div>
              <div className="card p-6 text-center bg-gradient-to-br from-yellow-50 to-yellow-100">
                <div className="text-5xl mb-3">‚õΩ</div>
                <p className="text-lg font-bold text-yellow-700">Fuel Total</p>
                <p className="text-3xl font-bold text-yellow-800 mt-2">
                  ‚Çπ{calculations.fuelTotal.toLocaleString()}
                </p>
              </div>
            </div>
          </div>
        );
      };

      const CreditCardExpenseSheet = () => {
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        const now = new Date();
        const [month, setMonth] = useState(months[now.getMonth()]);
        const [year, setYear] = useState(now.getFullYear().toString());
        const [entries, setEntries] = useState([]);
        const [syncStatus, setSyncStatus] = useState("synced");
        const isInitialLoad = useRef(true);

        const monthIndex = months.indexOf(month);
        const monthKey = `${year}-${String(monthIndex + 1).padStart(2, "0")}`;
        const collectionPath = "creditCardExpenses";

        const mealOptions = ["", "Lunch", "Tea"];

        const loadFromCloud = useCallback(async () => {
          try {
            const doc = await db
              .collection(collectionPath)
              .doc(FIXED_USER_ID)
              .collection("months")
              .doc(monthKey)
              .get();
            if (doc.exists) {
              const data = doc.data();
              setEntries(data.entries || []);
              if (data.month && data.year) {
                setMonth(data.month);
                setYear(data.year);
              }
            } else {
              setEntries([]);
            }
          } catch (e) {
            console.error(e);
          }
        }, [monthKey]);

        const syncToCloud = useCallback(
          async (data) => {
            if (isInitialLoad.current) return;
            try {
              setSyncStatus("syncing");
              await db
                .collection(collectionPath)
                .doc(FIXED_USER_ID)
                .collection("months")
                .doc(monthKey)
                .set(data);
              setSyncStatus("synced");
            } catch (e) {
              console.error(e);
              setSyncStatus("error");
            }
          },
          [monthKey]
        );

        useEffect(() => {
          loadFromCloud();
        }, [loadFromCloud]);

        useEffect(() => {
          if (isInitialLoad.current) {
            isInitialLoad.current = false;
            return;
          }
          const timer = setTimeout(() => {
            syncToCloud({
              month,
              year,
              entries,
              lastUpdated: new Date().toISOString(),
            });
          }, 800);
          return () => clearTimeout(timer);
        }, [month, year, entries, syncToCloud]);

        const addEntry = () => {
          const newId = entries.length
            ? Math.max(...entries.map((e) => e.id)) + 1
            : 1;
          setEntries((prev) => [
            ...prev,
            {
              id: newId,
              date: new Date().toISOString().split("T")[0],
              description: "",
              meal: "",
              amount: "",
            },
          ]);
        };

        const deleteEntry = (id) => {
          setEntries((prev) => prev.filter((e) => e.id !== id));
        };

        const updateEntry = (id, field, value) => {
          setEntries((prev) =>
            prev.map((e) => (e.id === id ? { ...e, [field]: value } : e))
          );
        };

        const calculations = useMemo(() => {
          const total = entries.reduce(
            (sum, e) => sum + (Number(e.amount) || 0),
            0
          );

          const lunchEntries = entries.filter((e) => e.meal === "Lunch");
          const teaEntries = entries.filter((e) => e.meal === "Tea");
          const fuelEntries = entries.filter((e) =>
            e.description.toLowerCase().includes("fuel")
          );

          const lunchCount = lunchEntries.length;
          const lunchTotal = lunchEntries.reduce(
            (s, e) => s + (Number(e.amount) || 0),
            0
          );
          const teaCount = teaEntries.length;
          const teaTotal = teaEntries.reduce(
            (s, e) => s + (Number(e.amount) || 0),
            0
          );
          const fuelTotal = fuelEntries.reduce(
            (s, e) => s + (Number(e.amount) || 0),
            0
          );

          const otherTotal = total - lunchTotal - teaTotal - fuelTotal;

          return {
            total,
            lunchCount,
            lunchTotal,
            teaCount,
            teaTotal,
            fuelTotal,
            otherTotal,
          };
        }, [entries]);

        const getSyncColor = () =>
          syncStatus === "syncing"
            ? "text-yellow-600"
            : syncStatus === "synced"
            ? "text-green-600"
            : "text-red-600";
        const getSyncText = () =>
          syncStatus === "syncing"
            ? "Syncing..."
            : syncStatus === "synced"
            ? "Saved"
            : "Sync error";

        return (
          <div>
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8 gap-6">
              <div className="flex items-center gap-4">
                <CreditCard />
                <h1 className="text-3xl font-bold text-gray-800">
                  Credit Card Expenses
                </h1>
              </div>
              <div className={`flex items-center gap-2 ${getSyncColor()}`}>
                <Cloud />
                <span className="text-sm font-medium">{getSyncText()}</span>
              </div>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Month
                </label>
                <select
                  value={month}
                  onChange={(e) => setMonth(e.target.value)}
                  className="w-full px-5 py-4 border border-gray-300 rounded-xl text-base"
                >
                  {months.map((m) => (
                    <option key={m} value={m}>
                      {m}
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Year
                </label>
                <input
                  type="number"
                  value={year}
                  onChange={(e) => setYear(e.target.value)}
                  className="w-full px-5 py-4 border border-gray-300 rounded-xl text-base"
                />
              </div>
              <div className="flex items-end">
                <button
                  onClick={addEntry}
                  className="w-full flex items-center justify-center gap-2 bg-red-600 text-white px-6 py-4 rounded-xl hover:bg-red-700 font-bold shadow-md"
                >
                  <Plus /> Add Expense
                </button>
              </div>
            </div>

            <div className="overflow-x-auto table-container -mx-4 sm:mx-0 mb-10">
              <table className="w-full min-w-[700px]">
                <thead className="bg-red-600 text-white">
                  <tr>
                    <th className="px-4 py-3 text-left font-semibold text-sm">
                      Date
                    </th>
                    <th className="px-4 py-3 text-left font-semibold text-sm">
                      Description
                    </th>
                    <th className="px-4 py-3 text-left font-semibold text-sm">
                      Meal
                    </th>
                    <th className="px-4 py-3 text-left font-semibold text-sm">
                      Amount (‚Çπ)
                    </th>
                    <th className="px-4 py-3 text-center font-semibold text-sm">
                      Action
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {entries.map((entry, i) => (
                    <tr
                      key={entry.id}
                      className={i % 2 === 0 ? "bg-gray-50" : "bg-white"}
                    >
                      <td className="px-4 py-3">
                        <input
                          type="date"
                          value={entry.date}
                          onChange={(e) =>
                            updateEntry(entry.id, "date", e.target.value)
                          }
                          className="w-full px-3 py-2 border rounded text-sm"
                        />
                      </td>
                      <td className="px-4 py-3">
                        <input
                          type="text"
                          value={entry.description}
                          onChange={(e) =>
                            updateEntry(entry.id, "description", e.target.value)
                          }
                          placeholder="e.g. Fuel, Amazon, etc."
                          className="w-full px-3 py-2 border rounded text-sm"
                        />
                      </td>
                      <td className="px-4 py-3">
                        <select
                          value={entry.meal}
                          onChange={(e) =>
                            updateEntry(entry.id, "meal", e.target.value)
                          }
                          className="w-full px-3 py-2 border rounded text-sm"
                        >
                          {mealOptions.map((opt) => (
                            <option key={opt} value={opt}>
                              {opt || "None"}
                            </option>
                          ))}
                        </select>
                      </td>
                      <td className="px-4 py-3">
                        <input
                          type="number"
                          min="0"
                          value={entry.amount}
                          onChange={(e) =>
                            updateEntry(entry.id, "amount", e.target.value)
                          }
                          placeholder="0"
                          className="w-full px-3 py-2 border rounded text-sm"
                        />
                      </td>
                      <td className="px-4 py-3 text-center">
                        <button
                          onClick={() => deleteEntry(entry.id)}
                          className="text-red-600 hover:text-red-800 p-2"
                        >
                          <Trash2 />
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-10">
              <div className="card p-6 text-center bg-gradient-to-br from-orange-50 to-orange-100">
                <div className="text-5xl mb-4">üç±</div>
                <p className="text-sm font-medium text-orange-700">Lunch</p>
                <p className="text-3xl font-bold text-orange-600 mt-2">
                  {calculations.lunchCount} times
                </p>
                <p className="text-xl text-orange-800">
                  ‚Çπ{calculations.lunchTotal.toLocaleString()}
                </p>
              </div>

              <div className="card p-6 text-center bg-gradient-to-br from-purple-50 to-purple-100">
                <div className="text-5xl mb-4">‚òï</div>
                <p className="text-sm font-medium text-purple-700">Tea</p>
                <p className="text-3xl font-bold text-purple-600 mt-2">
                  {calculations.teaCount} times
                </p>
                <p className="text-xl text-purple-800">
                  ‚Çπ{calculations.teaTotal.toLocaleString()}
                </p>
              </div>

              <div className="card p-6 text-center bg-gradient-to-br from-yellow-50 to-yellow-100">
                <div className="text-5xl mb-4">‚õΩ</div>
                <p className="text-sm font-medium text-yellow-700">Fuel</p>
                <p className="text-3xl font-bold text-yellow-600 mt-2">
                  ‚Çπ{calculations.fuelTotal.toLocaleString()}
                </p>
              </div>

              <div className="card p-6 text-center bg-gradient-to-br from-gray-50 to-gray-100">
                <div className="text-5xl mb-4">üõçÔ∏è</div>
                <p className="text-sm font-medium text-gray-700">Other</p>
                <p className="text-3xl font-bold text-gray-800 mt-2">
                  ‚Çπ{calculations.otherTotal.toLocaleString()}
                </p>
              </div>

              <div className="card p-8 text-center bg-gradient-to-br from-red-50 to-red-100 shadow-xl">
                <p className="text-lg font-bold text-red-700 uppercase tracking-wide">
                  Total Spent
                </p>
                <p className="text-5xl font-extrabold text-red-600 mt-4">
                  ‚Çπ{calculations.total.toLocaleString()}
                </p>
              </div>
            </div>

            <div className="text-center text-sm text-gray-500">
              User ID: {FIXED_USER_ID} ‚Ä¢ Data auto-saved to cloud
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
